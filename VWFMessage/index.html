<!DOCTYPE html>
<html>
<head>
	<title>VWF - Message generator - W4mp3</title>
	<meta charset="UTF-8">
	<style>
		* {
			font: 100% sans-serif;
			box-sizing: border-box;
		}
		
		html {
			background-color: #444;
			color: #DDD;
		}
		
		#cmdBox {
			width:640px;
			height: 100%;
			position: fixed;
			right: -640px;
			top: 0;
			border: 2px solid #000;
			box-shadow: 0 0 4px #000;
			background-color: #DDD;
			color: #444;
			transition-duration: 1s;
		}
		
		table {
			width:100%;
		}
		
		table tr td {
			vertical-align: top;
		}
		
		#cmdBox table tr td {
			border: 1px solid #888;
		}
		
		#cmdBox table tr td:first-child {
			text-align:center;
			font-weight: bold;
		}
		
		th {
			font-weight: bold;
		}
		
		fieldset {
			border: 2px solid #000;
			border-radius: 4px;
			box-shadow: 0 0 0 4px #28F,
									0 0 0 6px #000;
			margin-right: 20px;
			
		}
		
		legend {
			border: 2px solid #000;
			border-radius: 4px;
			box-shadow: 0 0 0 4px #28F,
									0 0 0 6px #000;
			font-size: 150%;
			padding: 0 8px;
			background-color: #148;
		}
		
		h1 {
			font-size: 200%;
			font-weight: bold;
			text-align: center;
			border: 2px solid #000;
			border-radius: 4px;
			box-shadow: 0 0 0 4px #28F,
									0 0 0 6px #000;
			background: #148;
		}
		
		h2 {
			font-size: 125%;
			font-weight: bold;
		}
		
		canvas {
			border: 4px solid #000;
		}
		
		textarea {
			font-family: monospace;
			font-size: 125%;
			width: 100%;
			max-width: 100%;
			height: 320px;
			
		}
		
		.tooltip {
			cursor: help;
			border-bottom: 1px dashed #888;
		}
		
		nav {
		}
		
		nav div {
			border: 2px solid #000;
			color: #222;
			text-shadow: 0 0 1px #FFF;
			float:left;
			padding: 8px;
			width: 20%;
			background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 66%, rgba(0,0,0,0.33) 100%);
			background-color: #EEE;
			cursor: pointer;
		}
		
		nav div:hover {
			background: linear-gradient(to bottom, rgba(255,255,255,1) 0%, rgba(0,0,0,0) 66%, rgba(0,0,0,0.33) 100%);
			background-color: #48F;
		}
		
		nav:after {
			clear:both;
		}
		
		.clearFloat {
			border:none;
			clear:both;
		}
		
		.tab_active {
			background-color: #48F;
			font-weight: bold;
		}
		
		.tab {
			height: 240px;
			background-color: #EEE;
			color: #444;
			border: 2px solid #000;
			padding: 16px;
		}
		
		.messagebody {
			border: 2px solid #000;
			background: #EEE;
			color: #222;
			float:left;
			width: 50%;
			margin-top: 8px;
			min-height: 448px;
			padding: 8px;
		}
		
		.preview {
			padding: 8px;
			border: 2px solid #000;
			background: #EEE;
			color: #222;
			margin-top: 8px;
			margin-left: 50%;
			min-height: 448px;
		}
		
		.output {
			padding: 8px;
			border: 2px solid #000;
			background: #EEE;
			color: #222;
			clear:both;
		}
		
		.leftColumn {
			float:left;
			width: 50%;
		}
		
		.rightColumn {
			margin-left: 50%;
		}
	</style>
</head>
<body>
<h1>VWF - Message generator</h1>
<nav id="navi">
	
</nav>
<hr class="clearFloat">
<div class="tab" id="tab_location" style="display: none;">
	<input type="number" id="xPos" min="0" max="28" value="1"> X-Position of messagebox<br>
	<input type="number" id="yPos" min="0" max="24" value="1"> Y-Position of messagebox<br>
	<input type="number" id="width" min="0" max="15" value="14"> Width of messagebox<br>
	<input type="number" id="height" min="0" max="13" value="3"> Height of messagebox
</div>
<div class="tab" id="tab_font" style="display: none;">
	<input type="checkbox" id="multibyteText" disabled="disabled"> <span class="tooltip" title="Not supported, sorry :( If there is much interest I might implement this">16-Bit mode</span><br>
	<input type="number" id="spaceWidth" min="0" max="16" value="8"> Width of a space char (values over 8 are recommended)<br>
	Wait <input type="number" id="textSpeed" min="0" max="63" value="0"> Frames per letter.
</div>
<div class="tab" id="tab_textbox" style="display: none;">
	<input type="number" id="autoWait" min="0" max="255" value="1"> <span class="tooltip" title="Use 0 to automaticaly clear the Textbox, 1 to wait for user-input (A button), 2-255 waits that amount of Frames until it clears it.">Auto wait options [?]</span><br>
	Textbox creation mode:
	<select id="textboxCreation">
		<option value="0">No Textbox</option>
		<option value="1" selected="selected">Secret of Evermore style</option>
		<option value="2">Secret of Mana style</option>
		<option value="3">Mega Man Zero style</option>
		<option value="4">Show instant</option>
	</select><br>
	<input type="color" id="letterColors" value="#FFFFFF"> Color of Letters in Pallete<br>
	<input type="color" id="shadeColors" value="#000000"> Color of Shading in Pallete<br>
	<input type="checkbox" id="freezeSprites" checked="checked"> Freeze Sprites<br>
	<input type="checkbox" id="speedUp" checked="checked"> Allow speed up by pressing A<br>
	Use Palette
	<select id="paletteBackground">
		<option value="0">Palette 0</option>
		<option value="1">Palette 1</option>
		<option value="2">Palette 2</option>
		<option value="3">Palette 3</option>
		<option value="4">Palette 4</option>
		<option value="5">Palette 5</option>
		<option value="6">Palette 6</option>
		<option value="7" selected="selected">Palette 7</option>
	</select>for Textbox<br>
	<input type="checkbox" id="centerMessage" > Center Message<br>
	<input type="number" id="padding" min="0" max="16" value="0"> Pixels from the border
</div>
<div class="tab" id="tab_sfx" style="display: none;">
	<div class="leftColumn">
		<input type="checkbox" id="sfx"> Disable SFX<br>
		Use Soundbank
		<select id="letterSfx">
			<option value="0" selected="selected">$1DF9</option>
			<option value="1">$1DFA</option>
			<option value="2" disabled="disabled">$1DFB</option>
			<option value="3">$1DFC</option>
		</select>for Writing Text SFX<br>
		Use Soundbank
		<select id="waitSfx">
			<option value="0" selected="selected">$1DF9</option>
			<option value="1">$1DFA</option>
			<option value="2" disabled="disabled">$1DFB</option>
			<option value="3">$1DFC</option>
		</select>for Waiting for User input SFX<br>
		Use Soundbank
		<select id="cursorSfx">
			<option value="0">$1DF9</option>
			<option value="1">$1DFA</option>
			<option value="2" disabled="disabled">$1DFB</option>
			<option value="3" selected="selected">$1DFC</option>
		</select>for Cursor SFX<br>
		Use Soundbank
		<select id="pressedSfx">
			<option value="0">$1DF9</option>
			<option value="1">$1DFA</option>
			<option value="2" disabled="disabled">$1DFB</option>
			<option value="3" selected="selected">$1DFC</option>
		</select>for pressing A button SFX<br>
		SFX for writing Text: <input type="number" id="letterSfxNumber" min="0" max="255" value="19"><br>
		SFX for waiting: <input type="number" id="waitSfxNumber" min="0" max="255" value="19"><br>
		SFX for Cursor: <input type="number" id="cursorSfxNumber" min="0" max="255" value="35"><br>
		SFX for pressing A: <input type="number" id="pressedSfxNumber" min="0" max="255" value="41">
	</div>
	<div class="rightColumn">
		List of SFX (viewing only):<br>
		$1DF9:
		<select>
			<option>00 - No Sound</option>
			<option>01 - Hit head</option>
			<option>02 - Contact (spin jump on a spiky enemy)</option>
			<option>03 - Kick shell</option>
			<option>04 - Go in pipe, get hurt</option>
			<option>05 - Midway point</option>
			<option>06 - Yoshi gulp</option>
			<option>07 - Dry bones collapse</option>
			<option>08 - Kill enemy with a spin jump</option>
			<option>09 - Fly with cape</option>
			<option>10 - Get powerup</option>
			<option>11 - ON/OFF switch</option>
			<option>12 - Carry item past the goal</option>
			<option>13 - Get cape</option>
			<option>14 - Swim</option>
			<option>15 - Hurt while flying</option>
			<option>16 - Magikoopa shoot magic</option>
			<option>17 - Pause (stops music)</option>
			<option>18 - Pause (resumes music)</option>
			<option>19 - Enemy stomp 1</option>
			<option>20 - Enemy stomp 2</option>
			<option>21 - Enemy stomp 3</option>
			<option>22 - Enemy stomp 4</option>
			<option>23 - Enemy stomp 5</option>
			<option>24 - Enemy stomp 6</option>
			<option>25 - Enemy stomp 7</option>
			<option>26 - Grinder (slightly louder than the one in 1DFA)</option>
			<option>27 - Grinder (slightly louder than the one in 1DFA)</option>
			<option>28 - Yoshi/Dragon coin</option>
			<option>29 - Running out of time (combine this with the one in 1DFC, does not speed up tempo)</option>
			<option>30 - P balloon</option>
			<option>31 - Koopaling shrink/defeated</option>
			<option>32 - Yoshi spit ("OW!")</option>
			<option>33 - Valley of Bowser appears (a low, looping, rumbling noise)</option>
			<option>35 - Lemmy/Wendy fall</option>
			<option>37 - Blargg roar</option>
			<option>38 - Firework whistle 1</option>
			<option>39 - Firework bang 1</option>
			<option>40 - Firework whistle 2 (louder than #1)</option>
			<option>41 - Firework bang 2 (louder than #1)</option>
			<option>42 - Peach pops up from the Clown Car</option>
			<option>128- Time is running out! (includes tempo hike)</option>
		</select><br>
		$1DFA:
		<select>
			<option>00 - Nothing</option>
			<option>01 - Jump</option>
			<option>02 - Turn on Yoshi Drum channel (channel #5)</option>
			<option>03 - Turn off Yoshi Drum channel (channel #5)</option>
			<option>04 - Grinder</option>
			<option>255- Special value used to tell the SPC to get ready to download data.</option>
		</select>
		<br>
		$1DFB:
		<select disabled="disabled">
			<option>DO NOT USE</option>
		</select>
		<br>
		$1DFC:
		<select>
			<option>00 - Nothing</option>
			<option>01 - Coin</option>
			<option>02 - Hit a ? Block</option>
			<option>03 - Hit a ? Block with a vine inside</option>
			<option>04 - Spin jump</option>
			<option>05 - 1up</option>
			<option>06 - Shoot fireball</option>
			<option>07 - Shatter block/Monty Mole popping from the ground</option>
			<option>08 - Springboard</option>
			<option>09 - Bullet bill shoot</option>
			<option>10 - Egg hatch</option>
			<option>11 - Item placed in reserve box</option>
			<option>12 - Item falls from the reserve box</option>
			<option>13 - Same as 0C</option>
			<option>14 - L/R scroll</option>
			<option>15 - Door</option>
			<option>17 - Drumroll start</option>
			<option>18 - Drumroll end</option>
			<option>19 - Lose Yoshi</option>
			<option>20 - Unused? (In SMW2: Yoshi's Island it's the sound of a new level becoming available)</option>
			<option>21 - Overworld tile reveal</option>
			<option>22 - Overworld castle collapse</option>
			<option>23 - Fire spit (Used by Yoshi and the Bowser Statues)</option>
			<option>24 - Thunder</option>
			<option>25 - Clappin' Chuck clap/bubble snap</option>
			<option>26 - Castle destruction bomb</option>
			<option>27 - Castle destruction bomb fuse</option>
			<option>28 - Overworld switch palace block ejection</option>
			<option>29 - Running out of time (combine this with the one in 1DF9, does not speed up tempo)</option>
			<option>30 - Whistlin' Chuck whistle</option>
			<option>31 - Yoshi mount</option>
			<option>32 - Lemmy/Wendy lands in the lava</option>
			<option>33 - Yoshi's tongue</option>
			<option>34 - Message box/save prompt</option>
			<option>35 - Mario moves onto a level tile</option>
			<option>36 - P-switch running out</option>
			<option>37 - Yoshi stomps an enemy</option>
			<option>38 - Swooper</option>
			<option>39 - Podoboo</option>
			<option>40 - Enemy stunned/hurt (like Chargin' Chucks or the Koopalings)</option>
			<option>41 - Correct</option>
			<option>42 - Wrong</option>
			<option>43 - Firework whistle</option>
			<option>44 - Firework bang</option>
			<option>45 - Podoboo (-100% pan) &lt;- sound only comes out of the left speaker</option>
			<option>46 - Podoboo (-71% pan)</option>
			<option>47 - Podoboo (-43% pan)</option>
			<option>48 - Podoboo (-14% pan)</option>
			<option>49 - Podoboo (14% pan)</option>
			<option>50 - Podoboo (43% pan)</option>
			<option>51 - Podoboo (71% pan)</option>
			<option>52 - Podoboo (100% pan) &lt;- sound only comes out of the right speaker</option>
			<option>53+- Mirror of $1DF9's sound effects, starting at the hit head sound</option>
		</select>
	</div>
</div>
<div class="messagebody">
	<h2>Message Body</h2>
	<textarea id="messageBody" cols="48" rows="17">[palette=3]- Browser -[palette=7]
Hey Mario![wait=1E] I am happy [speed=08]meal [speed=00][char=05] is the same as 5.[wait] Your Powerlevel is [char=7E0019]! Let's break a color of the palette, shall we?[wait][color=22FF00FF]BAM! See what you have done! Anyways, how many coins do you have?[wait=1E] You have [decimal=7E0DBF01] coin(s). That is [hex=7E0DBF] in hex![wait] I do not like this tune, lets play something good![music=1A]Funky, isn't it? Hey, do you know, that you can select stuff?[select=24A8][option=yes][option=no][endoption]Yes
No
[label=yes]Thats cool, right?
[point=continue][label=no]Now you know!
[label=continue]Look, a monkey![wait]
This should be enough, thank you for listening! I let you play that stupid bonus game.[teleport=10000]
</textarea><br>
	Info: Some charaters and commands are automagicaly converted in the output. For special commands open the command reference on the top right corner.
</div>
<div class="preview">
	<h2>Preview</h2>
	<canvas id="draw" width="256" height="224">Your Browser does not support Canvas. You MUST upgrade your Browser to use this.</canvas>
	<canvas id="palette" width="256" height="256"></canvas><br>
	<button style="border-radius: 16px;background-color: #F00;box-shadow: 2px 2px 0 #800;border:none;width: 32px;height: 32px;" title="Emulate pressing A">A</button>
	<button style="height: 32px;" title="Restarts the whole deal with the Textbox creation and stuff." onclick="vwf.setup()">Restart</button><br>
	Import palette <input type="file" id="palFile" onchange="loadPal(this)"><br>
	Border
	<select id="borderStyle">
		<option value="0">None</option>
		<option value="1">Secret of Mana</option>
		<option value="2">Plain</option>
		<option value="3">Thorns</option>
		<option value="4">Strong</option>
		<option value="5">Plain inverted</option>
		<option value="6">Beams</option>
		<option value="7">Metal</option>
		<option value="8">Papyrus</option>
		<option value="9">Thin</option>
		<option value="10">Gear</option>
		<option value="11">Pillar</option>
		<option value="12">3D Pillars</option>
		<option value="13">Decorated</option>
		<option value="14">Rome</option>
		<option value="15">Scaley</option>
	</select><br>
	Pattern
	<select id="patternStyle">
		<option value="0">Transparent</option>
		<option value="1">Dotted 33%</option>
		<option value="2">Solid</option>
		<option value="3">Fence</option>
		<option value="4">Star</option>
		<option value="5">Horizontal 50%</option>
		<option value="6">Checker</option>
		<option value="7">Vertical 50%</option>
		<option value="8">Planks</option>
		<option value="9">Diagonals</option>
		<option value="10">Horizontal</option>
		<option value="11">Mesh</option>
		<option value="12">Basket</option>
	</select>
</div>
<br>
<div class="output">
	<h2>Output (copy this into vwfmessages.asm)</h2>
	<textarea id="output"></textarea>
</div>
<div id="cmdBox">
	<button onclick="cmdBox()" style="transform-origin: 0 0;transform: rotate(90deg);border: 2px solid #000;border-top:none;">v Open/close Toolbox v</button>
	<p style="padding-left:16px; margin-top: 0;">
		Hover over commands to see what the original readme said about the command. It is slightly altered so it fits with the commands below better. All numbers are in Hexadecimal!
	</p>
	<table style="border-collapse: collapse">
		<tr>
			<th>Command</th>
			<th>Description</th>
		</tr>
		<tr>
			<td title="Display Character: This displays character XX.  You may wonder what the point of this function is. Well, let's say you had a font file with 256 characters and you wanted to display character $FF. How would you do that? If you used 'db $FF', the game would treat this as special character $FF and end the dialogue. Using 'db $F4,$FF', however, it would display character $FF instead. So basically this function is for displaying characters that would otherwise be treated as special characters.">[char=XX]</td>
			<td>Displays the Charater XX. Use this, if you want to use FF as letter</td>
		</tr>
		<tr>
			<td title="Display RAM Character : Takes the content of a RAM address as the next character to display.">[char=XXXXXX]</td>
			<td>Displays the Character of address XXXXXX</td>
		</tr>
		<tr>
			<td title="Clear Text Box: Well what is there to say about this one? It's pretty obvious. This command clears the text box. Not more, not less. Well that's not true, it obviously also resets the text position to the top of the text box. That's all it does now, really.">[clear]</td>
			<td>Clears the textbox.</td>
		</tr>
		<tr>
			<td title="Edit Color: This command sets color XX to SNES RGB RRGGBB (Note: I convert this to the proper value) and is to be used together with $F3 (but not necessary). I recommend only to use $00 to $1F for XX, as these are the only colors that are restored at the end of the dialogue. Also once again avoid using colors that are used by the background or anything else that is visible during dialogue processing.">[color=TTRRGGBB]</td>
			<td>Changes the color TT to SNES-RGB RRGGBB (converts the color to SNES-Colorspace).</td>
		</tr>
		<tr>
			<td title="Display Decimal Number: The first somewhat complex function. It takes the content of a RAM address, converts it to a decimal number and then displays it. 'Address' of course means the RAM address. Refer to the SMW Central RAM Map for this. B is how many Bits the number has (0 means 8-Bit and 1 means 16-Bit) and Z defines whether to display prefixed zeros or not (0 for yes, 1 for no; yeah, I switched the order here :P ).">[decimal=XXXXXXBZ]</td>
			<td>Displays the Decimal amount of address XXXXXX with size of B and leading zeroes Z</td>
		</tr>
		<tr>
			<td title="End Dialogue: This character ends a dialogue and is mandatory to put at the end of EVERY dialogue. Not using it means the dialogue will continue forever and eventually start to display random text. After the patch reads an $FF the dialogue will end and the text box will vanishing [!sic], using the style defined in the dialogue header">[end]</td>
			<td>This command ends a dialogue and is mandatory to put at the end of EVERY dialogue. It's automaticaly added at the end.</td>
		</tr>
		<tr>
			<td title="Internal end of option list. Put this command after an list of options pointer.">[endoption]</td>
			<td>End of option pointer list</td>
		</tr>
		<tr>
			<td title="Change Font: Changes the number of the Font in use to XX. In short, the same stuff as the first option in the header. Also in 16-Bit-Mode this command is redundant as it does nothing.">[font=XX]</td>
			<td>Changes the font to XX.</td>
		</tr>
		<tr>
			<td title="Display Hexadecimal Number: Takes the content of a RAM address (XXXXXX) and displays it as a hex number.">[hex=XXXXXX]</td>
			<td>Displays the Hex value of address XXXXXX</td>
		</tr>
		<tr>
			<td title="This is actualy not a VWF-Command. I just added it, because it is needed for [point] and [option].">[label=XXXXXXX]</td>
			<td>Creates a label with name XXXXXXX</td>
		</tr>
		<tr>
			<td title="Set Message Number: This clears the text box, loads message XXXX, loads the header from the new message and then displays the new message.">[message=XXXX]</td>
			<td>This clears the text box, loads message XXXX, loads the header from the new message and then displays the new message.</td>
		</tr>
		<tr>
			<td title="Play BGM: This changes the background music to XX. Of course it has the usual music restrictions, like 'only using custom music from the same bank' if using carol's or Romi's Addmusic and stuff like that. NOTE: It is AddMusicK compatible, I've tested it. If you use the internal Emulator of Lunar Magic it will violently crash with error code 749">[music=XX]</td>
			<td>Changes the BGM to XX. Has a rare chance of crahsing (will absolutly crash in the internal Emulator of Lunar Magic).</td>
		</tr>
		<tr>
			<td title="Force Line Break: This - as the name suggests - forces a Line Break. Don't forget: If using a Line Break while already at the bottom line of the text box, the patch will do whatever you've defined in the Auto wait options in the dialogue header.">[newline]</td>
			<td>This - as the name suggests - forces a Line Break. You normaly do not have to use this.</td>
		</tr>
		<tr>
			<td title="Another one of those not real VWF-Commands, it just points to a label.">[option=XXXXXXX]</td>
			<td>An option which points to label XXXXXXX. Put this only after a [select] or [option], this is only pointing to a label!</td>
		</tr>
		<tr>
			<td title="Change Text Palette: This changes the palette currently in use for text to X (Range: 0-7). It allows you to use multiple colors for your text inside the same text box. Be careful as this overwrites the second color of whatever palette you're going to use with the background color of the text box.">[palette=X]</td>
			<td>Changes the palette of the text. Valid values are 0-7.</td>
		</tr>
		<tr>
			<td title="Modify Text Pointer: This makes the patch read text from another address. NOTE: Put a label in it, much easier.">[point=XXXXXXX]</td>
			<td>This makes the patch read text from XXXXXXX</td>
		</tr>
		<tr>
			<td title="Display Options: This is - without any doubt - the most complex of all special commands. This function gives the player various options in the text box, which he can then select with a cursor. After that the text pointer is changed to another address depending on the option the player selected. N is the amount of Options, S is the space between the cursor and the Text (4 is recomended) and CC is the character to use as the cursor (Default: A8). NOTE: Put N [option] after this command and do not put line-breaks or any other characters between them.">[select=NSCC]</td>
			<td>Start of selecting a option. N is the count of Options, S is the space between Cursor and Text and CC is the character to use as cursor</td>
		</tr>
		<tr>
			<td title="Change Text Speed: This changes the text speed to XX. NOTE: It waits XX Frames between letters.">[speed=XX]</td>
			<td>Changes the text speed to wait XX frames between each letter.</td>
		</tr>
		<tr>
			<td title="Setup Teleport: This sets up a teleport which will occure as soon as dialogue processing is over. NOTE: XXX = level or secondary exit number. W = 0: Destination is normal level; W = 1: Destination is water level; S = 0: Goto Level XXX; S = 1: Use secondary exit XXX;">[teleport=XXXWS]</td>
			<td>Teleports the Player to level or secondary exit XXX (000 - 1FF), W is water flag (0 = no water; 1 = water), S is "Use Secondary Exit"-flag (0 = no; 1 = yes)</td>
		</tr>
		<tr>
			<td title="Wait for A Button: This is a command which you'll use a lot in your messages. It makes the game wait for the player to press the A button. Usually you'll at least put it in front of the $FF at the end of each dialogue, otherwise the text box would just be closed and the player wouldn't even get to read everything in time. Of course, if you need to, you can also put it inbetween text. Also, whenver the game reads this character, it starts displaying that blinking cursor at the bottom of the text box until the player presses the A button.">[wait]</td>
			<td>Wait until the Player hits the A button</td>
		</tr>
		<tr>
			<td title="Wait for XX frames: This makes the patch wait for XX frames.">[wait=XX]</td>
			<td>Wait XX Frames</td>
		</tr>
	</table>
</div>
<script>
	function cmdBox() {
		var div = document.getElementById("cmdBox")
		if (div.style.right == "0px") {
			div.style.right = "-640px"
		} else {
			div.style.right = "0px"
		}
	}
	
	draw = document.getElementById("draw").getContext("2d")
	pal = document.getElementById("palette").getContext("2d")
	
	palData = [248,224,176,232,240,248,72,144,112,88,160,128,104,176,144,120,192,160,136,208,176,152,224,192,152,224,224,0,0,0,216,56,24,88,248,88,152,224,224,0,0,0,232,240,248,248,88,88,248,224,176,232,240,248,248,248,248,0,0,0,0,200,248,0,224,248,0,248,248,0,248,248,152,224,224,0,0,0,88,168,240,248,248,248,152,224,224,0,0,0,216,160,56,248,216,112,248,224,176,232,240,248,0,0,0,120,104,24,200,152,88,0,120,72,224,192,80,0,200,0,0,0,0,248,248,248,0,0,0,0,200,0,176,0,0,248,0,0,248,88,0,248,160,0,248,224,176,232,240,248,0,0,0,88,88,88,120,120,120,152,152,152,192,192,192,224,224,224,0,0,0,248,248,248,0,0,0,0,200,0,232,24,104,240,64,168,248,120,200,248,192,240,248,224,176,232,240,248,112,112,112,0,0,0,192,192,192,160,200,248,168,224,248,192,248,248,0,0,0,248,248,248,0,0,0,0,200,0,0,224,0,136,248,56,200,248,0,248,248,152,248,224,176,232,240,248,0,0,0,184,168,96,216,248,200,0,128,0,0,200,0,0,248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,224,176,232,240,248,0,0,0,136,88,24,248,8,248,216,160,56,248,216,32,248,248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,224,176,232,240,248,0,0,0,184,0,80,248,0,128,72,72,136,104,104,176,128,128,200,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,224,176,248,248,248,0,0,0,136,88,24,216,160,56,248,216,112,248,208,192,232,0,176,80,0,0,248,64,112,32,48,136,64,128,152,128,216,200,176,40,96,248,112,104,248,248,0,248,224,176,248,248,248,0,0,0,112,112,112,160,160,160,192,192,192,224,224,224,248,16,88,0,0,0,248,248,248,0,0,0,0,200,0,176,0,0,248,0,0,248,88,0,248,160,0,248,224,176,248,248,248,0,0,0,248,120,0,248,192,0,248,248,0,184,40,0,248,136,0,0,0,0,248,248,248,0,0,0,0,200,0,232,24,104,240,64,168,248,120,200,248,192,240,248,224,176,248,248,248,0,0,0,64,64,216,104,104,216,136,136,248,184,40,0,248,136,0,0,0,0,248,248,248,0,0,0,0,200,0,0,224,0,136,248,56,200,248,0,248,248,152,248,224,176,248,248,248,0,0,0,136,0,0,184,0,0,248,0,0,184,40,0,248,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,224,176,248,248,248,0,0,0,0,120,0,0,184,0,0,248,0,184,40,0,248,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,224,176,248,248,248,0,0,0,40,48,72,72,80,88,104,104,88,152,144,64,192,192,120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,248,224,176,248,248,248,24,72,72,32,112,104,40,136,120,48,160,136,56,184,152,248,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
	pal32Cols = palData.slice(0,96) // used for restoring the 2bpp-palettes
	
	borderPalettes = [
										["#000000","#FFFFFF","#000000"],
										["#B09010","#603808","#201000"],
										["#687888","#303848","#081018"],
										["#E8D888","#A89058","#685040"],
										["#203000","#F8D838","#887028"],
										["#E0E0E0","#8090A0","#000000"],
										["#F8C888","#E0B078","#F8E0C8"],
										["#A888A0","#504050","#F8E0C8"],
										["#809060","#484058","#181818"],
										["#809060","#484058","#181818"],
										["#809060","#484058","#181818"],
										["#687888","#303848","#081018"],
										["#B09010","#603808","#201000"],
										["#807830","#583000","#201000"],
										["#809060","#484058","#181818"],
										["#809060","#484058","#181818"],
									 ]
	
	fontCanvas = document.createElement("canvas")
	font = fontCanvas.getContext("2d")
	fontCanvas.width = "4096"
	fontCanvas.height = "16"
	
	borderCanvas = document.createElement("canvas")
	border = borderCanvas.getContext("2d")
	borderCanvas.width = "72"
	borderCanvas.height = "128"
	
	
	patternCanvas = document.createElement("canvas")
	pattern = patternCanvas.getContext("2d")
	patternCanvas.width = "112"
	patternCanvas.height = "8"
	
	// Load images:
	
  images = ["font.png","border.png","pattern.png"]
	imgObj = []
	imagesLoaded = 0
	
	for (var i = 0; i < images.length; i++) {
		imgObj.push(new Image())
		imgObj[i].src = images[i]
		imgObj[i].onload = function (e) {
			imagesLoaded++
		}
	}
	
	
	function loop() {
		
		draw.fillStyle = "rgb("+palData[0]+","+palData[1]+","+palData[2]+")"
		draw.fillRect(0,0,256,224)
		
		if (imagesLoaded == images.length) {
			imagesLoaded++
			font.drawImage(imgObj[0],0,0)
			border.drawImage(imgObj[1],0,0)
			pattern.drawImage(imgObj[2],0,0)
		}

		window.requestAnimationFrame(loop)
	}
	
	loop()
	paletteDraw()
	
	function loadPal(fileObj) {
		file = fileObj.files[0]
		if (!(/ *\.pal/.test(file.name)) || file.size != 768) {
			alert("Not a .pal file.")
			return false
		}
		console.log("File is .pal-File or something that is the required 768 bytes big.")
		fileReader = new FileReader()
		
		fileReader.onload = function(data) {
			palBefore = palData
			var palette = data.target.result
			for (var i = 0; i < 768; i++) {
				palData[i] = palette[i].charCodeAt()
			}
			pal32Cols = palData.slice(0,96)
			paletteDraw()
		}
		
		fileReader.readAsBinaryString(file)
	}
	
	function paletteDraw() {
		pal.clearRect(0,0,256,224)
		
		for (var x = 0; x < 16; x++) {
			for (var y = 0; y < 16; y++) {
				pal.fillStyle = "rgb("+palData[y*48+x*3]+","+palData[y*48+x*3+1]+","+palData[y*48+x*3+2]+")"
				pal.fillRect(x*16,y*16,16,16)
			}
		}
		
		// Draw checkerboard pattern over first color of palettes (it is always transparent)
		
		pal.fillStyle = "rgba(0,0,0,0.1)"
		
		for (var x = 0; x < 32; x++) {
			if (x % 2) {
				pal.fillRect(0,x*8,8,8)
			} else {
				pal.fillRect(8,x*8,8,8)
			}
		}
	}
	
	function vwfmessageEmulator () {
		this.canvas = document.createElement("canvas")
		this.canvas.width = 256
		this.canvas.height = 224
		this.draw = this.canvas.getContext("2d")
		this.frame = 0
		this.state = 0
		this.x = 0
		this.y = 0
		this.width = 15
		this.height = 3
		this.font = 0
		this.spaceWidth = 8
		this.waitFrames = 0
		this.waitFramesTime = 0
		this.autoWait = 0
		this.creationMode = 0
		this.textColor = "#FFFFFF"
		this.shadingColor = "#000000"
		this.freezeSprite = true
		this.speedUpA = true
		this.borderPalette = 2
		this.centerMessage = false
		this.distanceFromBorder = 0
		this.data = ""
		this.asm = ""
		this.temp = []
		this.drawBackgroundPattern = true
		this.utf82vwfData =[	
													"","","$FF","","","","","","","","$FD\ndb ","","","$FD\ndb ","","",
													"","","","","","","","","","","","","","","","",
													"$FE","$74","$7A","$86","$97","$85","$84","$7F","$8B","$8C","$A3","$9A","$80","$82","$81","$87",
													"$00","$01","$02","$03","$04","$05","$06","$07","$08","$09","$8A","$89","$91","$9E","$92","$76",
													"$A5","$0A","$0B","$0C","$0D","$0E","$0F","$10","$11","$12","$13","$14","$15","$16","$17","$18",
													"$19","$1A","$1B","$1C","$1D","$1E","$1F","$20","$21","$22","$23","$8D","$88","$8E","$9F","$83",
													"$71","$24","$25","$26","$27","$28","$29","$2A","$2B","$2C","$2D","$2E","$2F","$30","$31","$32",
													"$33","$34","$35","$36","$37","$38","$39","$3A","$3B","$3C","$3D","$8F","$A4","$90","$A2","$FE",
													"","","","","","","","","","","","","","","","",
													"","","","","","","","","","","","","","","","",
													"$FE","$73","$26","$99","$32","$22","$A4","$A1","$FE","$A5","$24","$77","$82","$FE","$1B","$83",
													"$A0","$9A","$02","$03","$71","$96","$86","$81","$80","$01","$A0","$78","$93","$94","$95","$75",
													"$3E","$3F","$40","$0A","$41","$0A","$42","$44","$46","$47","$48","$49","$4A","$4B","$4C","$4D",
													"$0D","$4E","$4F","$50","$51","$18","$52","$3B","$18","$54","$55","$56","$57","$22","$25","$6D",
													"$59","$59","$5B","$24","$5C","$24","$5D","$5E","$60","$61","$62","$63","$64","$65","$66","$67",
													"$32","$68","$69","$6A","$6B","$32","$6C","$9D","$32","$6E","$6F","$70","$71","$3C","$25","$72"
												]
												
												
		this.utf82vwf = function (x) {
			return this.utf82vwfData[x]
		}
			
		this.setup = function (hexdata) {
			this.state = 0
			this.frame = 0
			this.parse()
		}
		
		this.parse = function (data) {
			this.data = document.getElementById("messageBody").value
			
			// Message Head
			
			this.asm = ".header\ndb $00\n"
			
			
			x1 = (parseInt(document.getElementById("xPos").value) << 11) + (parseInt(document.getElementById("yPos").value) << 6) + (parseInt(document.getElementById("width").value) << 2) + (parseInt(document.getElementById("height").value) >> 2 << 2)
			this.asm += "dw $" + byteSwap(pad(x1.toString(16),4)).toUpperCase() + "\n"
			
			x1 = (parseInt(document.getElementById("height").value) % 4 << 14) + (parseInt(document.getElementById("padding").value) << 10) + (parseInt(document.getElementById("spaceWidth").value) << 6) + (parseInt(document.getElementById("textSpeed").value))
			this.asm += "dw $" + byteSwap(pad(x1.toString(16),4)).toUpperCase() + "\n"
			
			x1 = (parseInt(document.getElementById("autoWait").value))
			this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
			
			x1 = (parseInt(document.getElementById("textboxCreation").value) << 4)
			this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
			
			x1 = rgb2snes(document.getElementById("letterColors").value)
			this.asm += "dw $" + pad(x1,4) + "\n"
			
			x1 = rgb2snes(document.getElementById("shadeColors").value)
			this.asm += "dw $" + pad(x1,4) + "\n"
			
			x1 = (document.getElementById("freezeSprites").checked << 7)
			x1+= (parseInt(document.getElementById("paletteBackground").value) << 4)
			x1+= (document.getElementById("centerMessage").checked << 3)
			x1+= (document.getElementById("speedUp").checked << 2)
			x1+= (document.getElementById("sfx").checked * 1)

			this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"

			if (!document.getElementById("sfx").checked) {
				// Only needed, if SFX are enabled.
			
				this.asm += ";;; SFX\n"
			
				x1 = (parseInt(document.getElementById("letterSfx").value) << 6) + (parseInt(document.getElementById("waitSfx").value) << 4) + (parseInt(document.getElementById("cursorSfx").value) << 2) + (parseInt(document.getElementById("pressedSfx").value))
				this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
				
				x1 = parseInt(document.getElementById("letterSfxNumber").value)
				this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
				
				x1 = parseInt(document.getElementById("waitSfxNumber").value)
				this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
				
				x1 = parseInt(document.getElementById("cursorSfxNumber").value)
				this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
				
				x1 = parseInt(document.getElementById("pressedSfxNumber").value)
				this.asm += "db $" + pad(x1.toString(16),2).toUpperCase() + "\n"
				
			}
			
			this.asm += "\n;;; Message Body ;;;\n.body:\n"
			
			// Message Body
						
			for (var i = 0; i < this.data.length; i++) {
				x1 = this.data.charAt(i)
				if (x1 == "[") {
					// Buffer for command
				
					var cmd = ""
				
					// Tags  w/o value = /\[(\w*)\]/g
					// Available Tags: clear, end, newline, wait
			
					// Tags with value = /\[(\w*)\=(\w*)\]/g
					// Avaliable Tags:	char, color, decimal, decimal0, font, hex, label, message, music,
					//									option, palette, point, select, speed, teleport, wait

					// testfor singular command
					
					var x2 = this.data.substring(i,i+16).match(/\[(\w*)\]/g)
					
					// Grab next ]
					
					var closingbracket = this.data.indexOf("]",i)

					if (x2 == null) {
						// is command with value
						var x2 = this.data.substring(i,closingbracket+1).match(/\[(\w*)\=(\w*)\]/)
						switch (x2[1]) {
							case "char":
								if (x2[2].length > 2) {
									// char at address
									cmd = "$F5,$"+pad(x2[2],6).toUpperCase()
								} else {
									// char number
									cmd = "$F4,$"+pad(x2[2],2).toUpperCase()
								}
								break
							case "color":
								// Change color at TT to RRGGBB (converted to SNES RGB)
								var colorid = pad(x2[2].substring(0,2),2).toUpperCase()
								var col = pad(rgb2snes(x2[2].substring(2)),4).toUpperCase()
								cmd = "$EE,$"+colorid+"\ndw $"+col+"\ndb $"
								break
							case "decimal":
								// Display decimal amount of Address XXXXXX with size of B and leading zeroes Z
								var address = x2[2].substring(0,6).toUpperCase()
								var size = x2[2].substring(6,7)
								var leadingZeroes = x2[2].substring(7)
								cmd = "$F7\ndl $"+address+"\ndb $"+size+leadingZeroes
								break
							case "font":
								// Change font
								cmd = "$F2,$"+pad(x2[2].toUpperCase())
								break
							case "hex":
								// Display Hexvalue of Address
								cmd = "$F5\ndl $"+pad(x2[2].toUpperCase(),6)+"\ndb $"
								break
							case "label":
								// Just a label.
								cmd = "\n."+x2[2]+"\n db $"
								break
							case "message":
								// Change to message XXXX
								cmd = "$FC\ndw $"+pad(x2[2],4).toUpperCase()+"\n db $"
								break
							case "music":
								// Changes the Music.
								cmd = "$EC,$"+pad(x2[2],2).toUpperCase()
								break
							case "option":
								// Pointer to Label
								cmd = "\ndl ."+x2[2]+"\n"
								break
							case "palette":
								// Change Palette
								cmd = "$F3,$"+pad(x2[2],2)
								break
							case "point":
								// JML :)
								cmd = "$FB\ndl ."+x2[2]
								break
							case "select":
								// Select stuffs
								var count = x2[2].substring(0,1)
								var space = x2[2].substring(1,2)
								var chr = pad(x2[2].substring(2),2).toUpperCase()
								cmd = "$F0,$"+count+space+",$"+chr+"\n"
								break
							case "speed":
								// Change Speed
								cmd = "$F8,$"+pad(x2[2],2).toUpperCase()
								break
							case "teleport":
								// Teleport to level XXX with Water-flag and "Zeckondarie eggsid"
								var level = pad(x2[2].substring(0,3).toUpperCase(),3)
								var isWater = parseInt(x2[2].substring(3,4))*8
								var useSecondary = parseInt(x2[2].substring(3,4))*2
								var flags = pad((isWater+useSecondary).toString(16),2).toUpperCase()
								cmd = "$EF\ndw $0"+level+"\ndb $"+flags
								break
							case "wait":
								// Wait XX Frames
								cmd = "$F9,$"+pad(x2[2],2).toUpperCase()
							default:
						}
					} else {
						// is command without value
						x2 = this.data.substring(i,closingbracket+1).match(/\[(\w*)\]/)
						switch (x2[1]) {
							case "clear":
								cmd = "$ED"
								// Clr Scrn
								break
							case "end":
								cmd = "$FF"
								// It's the end of the world as we know it...
								break
							case "endoption":
								cmd = "db $"
								break
							case "newline":
								cmd = "$FD"
								// Newline for whateverreason
								break
							case "wait":
								cmd = "$FA"
								// Wait. Hammer Time
							default:
						}
					}
					console.log(x2)
					i = closingbracket
					body.push(cmd)
				} else {
					body.push(this.utf82vwf(x1.charCodeAt(0)))
				}
			}
			
			this.asm += body.join(",")
			
			this.asm += ",$FF"
			
			this.asm += "\n;Message generated with VWF-Message generator by W4mp3"
			
			document.getElementById("output").innerHTML = this.asm
		}
	}
	vwf = new vwfmessageEmulator()
	
	function pad(str,pow) {
		while (str.length % pow != 0) {
			str = "0"+str
		} 
		return str
	}
	
	function byteSwap(str) {
		return str.substring(2,4) + str.substring(0,2)
	}
	
	function rgb2snes(color) {
		r = parseInt(color.substring(1,3),16) >> 3
		g = parseInt(color.substring(3,5),16) >> 3
		b = parseInt(color.substring(5,7),16) >> 3
		return (b * 1024 + g * 32 + r).toString(16).toUpperCase()
	}
	
	window.onload = function () {
		
	}
	
	tabs = {
		div : $("navi"),
		active : 0,
		tabContent : [$("tab_location"),$("tab_font"),$("tab_textbox"),$("tab_sfx")],		
		tabHeaders : ["Location and Size","Font settings","Textbox settings","Sound settings"],
		
		show : function (id) {
			this.hideAll()
			this.active = id
			this.tabContent[id].style.display = "block"
			this.render()
		},
		
		hideAll : function () {
			for (var i = 0; i < this.tabHeaders.length; i++) {
				this.tabContent[i].style.display = "none"
			}
		},
		
		render : function () {
			var html = "" 
			for (var i = 0; i < this.tabHeaders.length; i++) {
				if (i == this.active) {
					html += "<div class=\"tab_active\">" + this.tabHeaders[i] + "</div>"
				} else {
					html += "<div onclick=\"tabs.show("+i+")\">" + this.tabHeaders[i] + "</div>"
				}
			}
			this.div.innerHTML = html
		}
	}
	
	tabs.show(0)
	
	function $(id) {
		return document.getElementById(id)
	}
</script>
</body>
</html>